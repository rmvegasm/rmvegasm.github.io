{
  "hash": "cc3fcbf3ab69202d002a6c7d2e8cea4f",
  "result": {
    "markdown": "---\ntitle: Extracting tweets with the twitter API\ncategories:\n  - R\n  - NLP\n  - rtweet\n  - TPP11\ndate: \"2022/09/12\"\n---\n\n\nToday the TPP11 was approved by the chilean congress. WTF!?\n\nLet's try to get an idea of what people are saying about this on twitter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary('rtweet')\n# Authenticate the currently logged in user and store credentials, this needs to\n# be done only once per machine:\n# rtweet::auth_setup_default()\n\n# Do not perform query if results are already stored:\ntbl_file = 'tweets_tbl'\ntweets_file = 'tpp11_tweets.csv'\n\nif (file.exists(tweets_file)) {\n  tweets = read.csv(tweets_file)\n} else {\n  tweets = rtweet::search_tweets(\n    'TPP11 Chile -filter:quote -filter:replies',\n    n = 1000,\n    include_rts = FALSE,\n    retryonratelimit = TRUE\n  )\n  # let's save the tibble just in case and write a csv ommiting list cols\n  saveRDS(tweets, tbl_file)\n  tweets = tweets[, sapply(tweets, class) != 'list'] |> as.data.frame()\n  write.csv(tweets, tweets_file)\n}\n```\n:::\n\n\nLet's take a look at what we got:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(tweets, give.attr = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t642 obs. of  38 variables:\n $ X                            : int  1 2 3 4 5 6 7 8 9 10 ...\n $ created_at                   : chr  \"2022-10-12 14:09:24\" \"2022-10-12 16:19:04\" \"2022-10-11 19:45:39\" \"2022-10-12 17:39:17\" ...\n $ id                           : num  1.58e+18 1.58e+18 1.58e+18 1.58e+18 1.58e+18 ...\n $ id_str                       : num  1.58e+18 1.58e+18 1.58e+18 1.58e+18 1.58e+18 ...\n $ full_text                    : chr  \"‚ÄúSide Letters‚Äù: autogol d media cancha d Pdte @gabrielboric . Si aprueba TPP11, pierde ante su base radical; si\"| __truncated__ \"Bancada UDI pone en duda agenda legislativa y di√°logo constitucional si Gobierno dilata TPP11  https://t.co/NQcBH1SVjc\" \"üî¥ Aprueban TPP11: Senado ratifica adhesi√≥n de Chile al tratado https://t.co/o61z5in3oR\" \"No os preocup√©is @joseantoniokast salva chile y ratifica el TPP11.\" ...\n $ truncated                    : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...\n $ display_text_range           : int  263 118 86 66 250 130 217 277 129 117 ...\n $ source                       : chr  \"<a href=\\\"http://twitter.com/download/iphone\\\" rel=\\\"nofollow\\\">Twitter for iPhone</a>\" \"<a href=\\\"https://help.twitter.com/en/using-twitter/how-to-tweet#source-labels\\\" rel=\\\"nofollow\\\">Autopublicado\"| __truncated__ \"<a href=\\\"https://www.echobox.com\\\" rel=\\\"nofollow\\\">Echobox</a>\" \"<a href=\\\"http://twitter.com/download/iphone\\\" rel=\\\"nofollow\\\">Twitter for iPhone</a>\" ...\n $ in_reply_to_status_id        : logi  NA NA NA NA NA NA ...\n $ in_reply_to_status_id_str    : logi  NA NA NA NA NA NA ...\n $ in_reply_to_user_id          : logi  NA NA NA NA NA NA ...\n $ in_reply_to_user_id_str      : logi  NA NA NA NA NA NA ...\n $ in_reply_to_screen_name      : logi  NA NA NA NA NA NA ...\n $ contributors                 : logi  NA NA NA NA NA NA ...\n $ is_quote_status              : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...\n $ retweet_count                : int  375 124 54 0 1 0 0 5 0 5 ...\n $ favorite_count               : int  680 401 335 0 1 0 0 7 0 6 ...\n $ favorited                    : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...\n $ retweeted                    : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...\n $ lang                         : chr  \"es\" \"es\" \"es\" \"es\" ...\n $ possibly_sensitive           : logi  NA FALSE FALSE NA FALSE FALSE ...\n $ text                         : chr  \"‚ÄúSide Letters‚Äù: autogol d media cancha d Pdte @gabrielboric . Si aprueba TPP11, pierde ante su base radical; si\"| __truncated__ \"Bancada UDI pone en duda agenda legislativa y di√°logo constitucional si Gobierno dilata TPP11  https://t.co/NQcBH1SVjc\" \"üî¥ Aprueban TPP11: Senado ratifica adhesi√≥n de Chile al tratado https://t.co/o61z5in3oR\" \"No os preocup√©is @joseantoniokast salva chile y ratifica el TPP11.\" ...\n $ favorited_by                 : logi  NA NA NA NA NA NA ...\n $ scopes                       : logi  NA NA NA NA NA NA ...\n $ display_text_width           : logi  NA NA NA NA NA NA ...\n $ retweeted_status             : logi  NA NA NA NA NA NA ...\n $ quoted_status_id             : logi  NA NA NA NA NA NA ...\n $ quoted_status_id_str         : logi  NA NA NA NA NA NA ...\n $ quoted_status_permalink      : logi  NA NA NA NA NA NA ...\n $ quote_count                  : logi  NA NA NA NA NA NA ...\n $ timestamp_ms                 : logi  NA NA NA NA NA NA ...\n $ reply_count                  : logi  NA NA NA NA NA NA ...\n $ filter_level                 : logi  NA NA NA NA NA NA ...\n $ query                        : logi  NA NA NA NA NA NA ...\n $ withheld_scope               : logi  NA NA NA NA NA NA ...\n $ withheld_copyright           : logi  NA NA NA NA NA NA ...\n $ withheld_in_countries        : logi  NA NA NA NA NA NA ...\n $ possibly_sensitive_appealable: logi  NA NA NA NA NA NA ...\n```\n:::\n:::\n\n\nThe most *retweeted* text (presumably the original) is:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwith(tweets, full_text[which.max(retweet_count)]) |>\n  strwrap() |>\n  cat(fill = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAPROBADO‚úÖ| Senado aprob√≥ por 27 votos a favor, 10 en contra y 1 \nabstenci√≥n, el Tratado Integral y Progresista de Asociaci√≥n \nTranspac√≠fico, conocido como #TPP11.  \nEl proyecto de acuerdo pasa a la @camara_cl para comunicarle al \nEjecutivo la aprobaci√≥n del Congreso Nacional. ‚ñ∂ https://t.co/tGKC7XPDB2\n```\n:::\n:::\n\n\n\n::: {.cell filename='Complete Code' file='script.r'}\n\n```{.r .cell-code}\n## ----r------------------------------------------------------------------------\nlibrary('rtweet')\n# Authenticate the currently logged in user and store credentials, this needs to\n# be done only once per machine:\n# rtweet::auth_setup_default()\n\n# Do not perform query if results are already stored:\ntbl_file = 'tweets_tbl'\ntweets_file = 'tpp11_tweets.csv'\n\nif (file.exists(tweets_file)) {\n  tweets = read.csv(tweets_file)\n} else {\n  tweets = rtweet::search_tweets(\n    'TPP11 Chile -filter:quote -filter:replies',\n    n = 1000,\n    include_rts = FALSE,\n    retryonratelimit = TRUE\n  )\n  # let's save the tibble just in case and write a csv ommiting list cols\n  saveRDS(tweets, tbl_file)\n  tweets = tweets[, sapply(tweets, class) != 'list'] |> as.data.frame()\n  write.csv(tweets, tweets_file)\n}\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}